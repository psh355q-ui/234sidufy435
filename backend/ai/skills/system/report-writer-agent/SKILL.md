---
name: report-writer-agent
description: Automated report generator for daily, weekly, and monthly performance summaries. Creates markdown reports with trading performance, defensive wins, agent accuracy, and constitutional compliance statistics.
license: Proprietary
compatibility: Requires trading_signals, shadow_trades, proposals tables
metadata:
  author: ai-trading-system
  version: "1.0"
  category: system
  agent_role: report_writer
---

# Report Writer Agent - ìžë™ ë¦¬í¬íŠ¸ ìƒì„±ê¸°

## Role
ì¼ì¼/ì£¼ê°„/ì›”ê°„ ê±°ëž˜ ì„±ê³¼, ë°©ì–´ ì‹¤ì , Agent ì •í™•ë„, í—Œë²• ì¤€ìˆ˜ìœ¨ì„ ìžë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

## Core Capabilities

### 1. Report Types

#### Daily Report
- ì˜¤ëŠ˜ì˜ ê±°ëž˜ ìš”ì•½
- ìŠ¹/íŒ¨ ê±°ëž˜
- ì£¼ìš” Signal ì„±ê³¼

#### Weekly Report
- ì£¼ê°„ ìˆ˜ìµë¥ 
- Agentë³„ ì •í™•ë„
- Shadow Trade ë°©ì–´ ì‹¤ì 
- Top Performers

#### Monthly Report
- ì›”ê°„ ì´ì •ì‚°
- ëª©í‘œ ëŒ€ë¹„ ì‹¤ì 
- Sharpe Ratio, Max Drawdown
- í—Œë²• ì¤€ìˆ˜ìœ¨
- AI ìžê¸° ê°œì„  ì œì•ˆ

### 2. Performance Metrics

```python
# Trading Performance
total_trades: int
winning_trades: int
losing_trades: int
win_rate: float  # winning_trades / total_trades
average_return: float
sharpe_ratio: float
max_drawdown: float

# Defensive Performance
total_rejections: int
defensive_wins: int  # ê±°ë¶€í•œ ì œì•ˆì´ ì‹¤ì œ ì†ì‹¤ì´ì—ˆë˜ ê²½ìš°
defensive_win_rate: float
avoided_loss_usd: float

# Agent Accuracy
agent_accuracies: Dict[str, float]  # {agent_name: accuracy}
best_performing_agent: str
worst_performing_agent: str

# Constitutional Compliance
total_proposals: int
constitutional_violations: int
compliance_rate: float  # (total - violations) / total
```

### 3. Report Generation

```python
def generate_daily_report(date: str) -> str:
    """Generate daily markdown report"""
    
    # Fetch data
    signals = get_signals_for_date(date)
    shadows = get_shadow_trades_for_date(date)
    
    # Calculate metrics
    metrics = calculate_metrics(signals, shadows)
    
    # Generate markdown
    report = format_report(metrics, template='daily')
    
    return report
```

## Output Format

### Daily Report Example

```markdown
# ì¼ì¼ ê±°ëž˜ ë¦¬í¬íŠ¸ - 2025-12-21

## ðŸ“Š ê±°ëž˜ ìš”ì•½

- **ì´ Signal ìˆ˜**: 5ê°œ
- **ì‹¤í–‰ëœ ê±°ëž˜**: 3ê°œ
- **ê±°ë¶€ëœ ì œì•ˆ**: 2ê°œ (í—Œë²• ìœ„ë°˜)

## ðŸŽ¯ Signal ì„±ê³¼

| Signal ID | Ticker | Action | Source | Status | Return |
|-----------|--------|--------|--------|--------|--------|
| SIG-001 | AAPL | BUY | war_room | EXECUTED | +2.3% |
| SIG-002 | NVDA | BUY | deep_reasoning | EXECUTED | +5.1% |
| SIG-003 | TSLA | SELL | manual_analysis | EXECUTED | +1.5% |
| SIG-004 | XYZ | BUY | news_analysis | REJECTED | - |
| SIG-005 | ABC | BUY | ceo_analysis | REJECTED | - |

**ì¼ì¼ ìˆ˜ìµë¥ **: +3.0%

## ðŸ›¡ï¸ ë°©ì–´ ì‹¤ì 

### Shadow Trades (ê±°ë¶€ëœ ì œì•ˆ ì¶”ì )

| Ticker | Rejected Reason | Virtual P&L | Result |
|--------|----------------|-------------|--------|
| XYZ | í¬ì§€ì…˜ 20% ì´ˆê³¼ | -$1,200 | DEFENSIVE_WIN âœ… |
| ABC | Stop Loss ë¯¸ì„¤ì • | +$300 | MISSED_OPPORTUNITY |

**ë°©ì–´ ì„±ê³µ**: 1ê±´  
**íšŒí”¼í•œ ì†ì‹¤**: $1,200

## ðŸ“ˆ Agent ì„±ê³¼

| Agent | Signals | Accuracy | Contribution |
|-------|---------|----------|--------------|
| War Room | 1 | 100% | Excellent |
| Deep Reasoning | 1 | 100% | Excellent |
| Manual Analysis | 1 | 100% | Good |

## âš–ï¸ í—Œë²• ì¤€ìˆ˜

- **ì´ ì œì•ˆ**: 5ê°œ
- **ìœ„ë°˜ ê±´ìˆ˜**: 2ê°œ
- **ì¤€ìˆ˜ìœ¨**: 60%
- **ì£¼ìš” ìœ„ë°˜**: Article 4 (í¬ì§€ì…˜ í•œë„)

## ðŸ’¡ ì¸ì‚¬ì´íŠ¸

1. ëª¨ë“  ì‹¤í–‰ëœ ê±°ëž˜ê°€ ìˆ˜ìµ (Win Rate 100%)
2. Shadow Trade ë°©ì–´ ì„±ê³µìœ¼ë¡œ $1,200 ì†ì‹¤ íšŒí”¼
3. í—Œë²• ì œ4ì¡° ìœ„ë°˜ ì£¼ì˜ í•„ìš”

---
Generated by Report Writer Agent v1.0
```

### Weekly Report Example

```markdown
# ì£¼ê°„ ê±°ëž˜ ë¦¬í¬íŠ¸ - Week 51, 2025

## ðŸ“Š ì£¼ê°„ ìš”ì•½

- **ê¸°ê°„**: 2025-12-15 ~ 2025-12-21
- **ì´ Signal**: 23ê°œ
- **ì‹¤í–‰ ê±°ëž˜**: 15ê°œ
- **ê±°ë¶€ ì œì•ˆ**: 8ê°œ

## ðŸŽ¯ ì„±ê³¼ ì§€í‘œ

| Metric | Value | Target | Status |
|--------|-------|--------|--------|
| ì£¼ê°„ ìˆ˜ìµë¥  | +4.5% | +2% | âœ… ì´ˆê³¼ ë‹¬ì„± |
| Win Rate | 73% | >55% | âœ… |
| Sharpe Ratio | 1.45 | >1.0 | âœ… |
| Max Drawdown | -3.2% | <-5% | âœ… |

## ðŸ† Top Performers

### Best Signals
1. **NVDA** (deep_reasoning): +12.5%
2. **AAPL** (war_room): +8.3%
3. **MSFT** (ceo_analysis): +5.7%

### Worst Signals
1. **XYZ** (news_analysis): -2.1%
2. **ABC** (manual_analysis): -1.5%

## ðŸ›¡ï¸ ë°©ì–´ ì‹¤ì 

- **ì´ ê±°ë¶€**: 8ê±´
- **Defensive Wins**: 6ê±´ (75%)
- **íšŒí”¼í•œ ì†ì‹¤**: $5,400
- **Missed Opportunities**: 2ê±´ (+$800)

**ìˆœ ë°©ì–´ ê°€ì¹˜**: $4,600

## ðŸ¤– Agent ì •í™•ë„

| Agent | Signals | Win Rate | Avg Return | Rank |
|-------|---------|----------|------------|------|
| Deep Reasoning | 5 | 80% | +6.2% | 1 |
| War Room | 6 | 83% | +5.1% | 2 |
| CEO Analysis | 3 | 67% | +3.8% | 3 |
| Manual Analysis | 4 | 50% | +2.0% | 4 |
| News Analysis | 5 | 60% | +1.5% | 5 |

## âš–ï¸ í—Œë²• ì¤€ìˆ˜

- **ì´ ì œì•ˆ**: 23ê°œ
- **ìœ„ë°˜ ê±´ìˆ˜**: 8ê°œ
- **ì¤€ìˆ˜ìœ¨**: 65%

**ìœ„ë°˜ ë‚´ì—­**:
- Article 4 (Risk Management): 6ê±´
- Article 2 (Explainability): 2ê±´

## ðŸ’° ìžë³¸ ë³´ì¡´

- **ì‹œìž‘ ìžë³¸**: $100,000
- **ì¢…ë£Œ ìžë³¸**: $104,500
- **ìžë³¸ ë³´ì¡´ìœ¨**: 104.5%
- **í—Œë²•ì´ ë°©ì–´í•œ ì†ì‹¤**: $5,400 (5.4%)

## ðŸ“ ê¶Œìž¥ ì‚¬í•­

1. **Article 4 ìœ„ë°˜ ê°ì†Œ**: Risk Agent ê°€ì¤‘ì¹˜ ì¦ëŒ€
2. **News Analysis ì •í™•ë„ ê°œì„ **: ì‹ ë¢°ë„ ë‚®ì€ ì†ŒìŠ¤ í•„í„°ë§
3. **Deep Reasoning í™œìš© í™•ëŒ€**: ê°€ìž¥ ë†’ì€ ìŠ¹ë¥ 

---
Generated on 2025-12-21
```

## Decision Framework

```
Step 1: Determine Report Type
  - Daily: ë‹¹ì¼ ë°ì´í„°
  - Weekly: ìµœê·¼ 7ì¼
  - Monthly: ìµœê·¼ 30ì¼

Step 2: Fetch Data
  - trading_signals
  - shadow_trades
  - proposals
  - agent_votes

Step 3: Calculate Metrics
  - Performance: Win rate, returns, Sharpe
  - Defensive: Shadow trades, avoided loss
  - Agent: Individual accuracy
  - Constitutional: Violation rate

Step 4: Generate Insights
  - Best/worst performers
  - Trend analysis
  - Recommendations

Step 5: Format as Markdown
  - Tables for data
  - Alerts for important findings
  - Charts (optional, via mermaid)

Step 6: Distribute
  - Save to file
  - Send to Telegram
  - Display on dashboard
```

## Guidelines

### Do's âœ…
- **ê°ê´€ì  ë°ì´í„°**: ìˆ«ìžë¡œ ë§í•˜ê¸°
- **ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸**: êµ¬ì²´ì  ê°œì„  ë°©ì•ˆ ì œì‹œ
- **ì‹œê°ì  êµ¬ì„±**: í‘œ, ê·¸ëž˜í”„ í™œìš©
- **íŠ¸ë Œë“œ ê°•ì¡°**: ê°œì„ /ì•…í™” ì¶”ì„¸ í‘œì‹œ

### Don'ts âŒ
- ê³¼ë„í•œ ì¹­ì°¬/ë¹„ë‚œ ê¸ˆì§€ (ê°ê´€ì„± ìœ ì§€)
- ë°ì´í„° ì¡°ìž‘ ì ˆëŒ€ ê¸ˆì§€
- ë¶ˆí•„ìš”í•œ ë³µìž¡ì„± ì§€ì–‘
- ê²°ë¡  ì—†ëŠ” ë‚˜ì—´ ê¸ˆì§€

## Integration

### Data Sources

```python
from backend.database.models import TradingSignal, ShadowTrade, Proposal
from sqlalchemy import func
from datetime import datetime, timedelta

def get_weekly_performance(start_date: datetime) -> Dict:
    """Get weekly performance metrics"""
    
    end_date = start_date + timedelta(days=7)
    
    # Fetch signals
    signals = db.query(TradingSignal).filter(
        TradingSignal.created_at >= start_date,
        TradingSignal.created_at < end_date
    ).all()
    
    # Calculate metrics
    total_signals = len(signals)
    executed = [s for s in signals if s.status == 'EXECUTED']
    
    returns = [s.actual_return for s in executed if s.actual_return is not None]
    win_rate = sum(1 for r in returns if r > 0) / len(returns) if returns else 0
    
    avg_return = sum(returns) / len(returns) if returns else 0
    
    # Shadow trades
    shadows = db.query(ShadowTrade).filter(
        ShadowTrade.created_at >= start_date,
        ShadowTrade.created_at < end_date
    ).all()
    
    defensive_wins = sum(1 for s in shadows if s.status == 'DEFENSIVE_WIN')
    
    return {
        'total_signals': total_signals,
        'executed': len(executed),
        'win_rate': win_rate,
        'avg_return': avg_return,
        'defensive_wins': defensive_wins,
        'shadows': len(shadows)
    }
```

### Report Distribution

```python
from backend.notifications.telegram_commander_bot import TelegramCommanderBot

async def send_daily_report(report_markdown: str):
    """Send report via Telegram"""
    
    telegram = TelegramCommanderBot()
    
    await telegram.send_message(
        chat_id=os.getenv('TELEGRAM_COMMANDER_CHAT_ID'),
        text=report_markdown,
        parse_mode='Markdown'
    )
```

## Performance Metrics

- **Report Generation Time**: ëª©í‘œ < 5ì´ˆ
- **Data Accuracy**: 100% (DBì—ì„œ ì§ì ‘ ê³„ì‚°)
- **Delivery Success**: > 99% (Telegram)
- **User Satisfaction**: ë¦¬í¬íŠ¸ ìœ ìš©ì„± í”¼ë“œë°±

## Mermaid Charts Example

```markdown
## ì£¼ê°„ ìˆ˜ìµë¥  ì¶”ì´

```mermaid
line chart
    title "Daily P&L - Week 51"
    x-axis [Mon, Tue, Wed, Thu, Fri]
    y-axis "Return %" -2 --> 6
    line [1.2, 2.5, -0.8, 3.1, 4.5]
```
```

## Version History

- **v1.0** (2025-12-21): Initial release with daily/weekly/monthly reports
