# Phase 25.2 - ì„±ê³¼ ëŒ€ì‹œë³´ë“œ UI ì™„ë£Œ

**ë‚ ì§œ**: 2025-12-23
**Phase**: 25.2 - Agent Performance Dashboard
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ“‹ ì™„ë£Œëœ ì‘ì—…

### 1ï¸âƒ£ Performance API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

**íŒŒì¼**: [backend/api/performance_router.py](../../backend/api/performance_router.py)

**API ì—”ë“œí¬ì¸íŠ¸**:

#### GET /api/performance/summary
ì „ì²´ ì„±ê³¼ ìš”ì•½ ì •ë³´ ì œê³µ

**Response**:
```json
{
  "total_predictions": 100,
  "correct_predictions": 67,
  "accuracy": 67.0,
  "avg_return": 1.23,
  "avg_performance_score": 0.0089,
  "best_action": "BUY"
}
```

**ì¿¼ë¦¬**:
```sql
SELECT
    COUNT(*) as total_predictions,
    SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct_predictions,
    ROUND(
        CAST(SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) AS NUMERIC) /
        NULLIF(COUNT(*), 0) * 100, 2
    ) as accuracy,
    ROUND(AVG(return_pct), 4) as avg_return,
    ROUND(AVG(performance_score), 4) as avg_performance_score
FROM price_tracking
WHERE status = 'COMPLETED'
```

#### GET /api/performance/by-action
ì•¡ì…˜ë³„ ì„±ê³¼ ë¶„ì„ (BUY/SELL/HOLD)

**Response**:
```json
[
  {
    "action": "BUY",
    "total": 45,
    "correct": 34,
    "accuracy": 75.56,
    "avg_return": 1.45,
    "avg_performance_score": 0.0102
  },
  {
    "action": "SELL",
    "total": 30,
    "correct": 19,
    "accuracy": 63.33,
    "avg_return": -0.87,
    "avg_performance_score": 0.0056
  },
  {
    "action": "HOLD",
    "total": 25,
    "correct": 14,
    "accuracy": 56.00,
    "avg_return": 0.12,
    "avg_performance_score": 0.0008
  }
]
```

**ì¿¼ë¦¬**:
```sql
SELECT
    consensus_action as action,
    COUNT(*) as total,
    SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct,
    ROUND(
        CAST(SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) AS NUMERIC) /
        NULLIF(COUNT(*), 0) * 100, 2
    ) as accuracy,
    ROUND(AVG(return_pct), 4) as avg_return,
    ROUND(AVG(performance_score), 4) as avg_performance_score
FROM price_tracking
WHERE status = 'COMPLETED'
GROUP BY consensus_action
ORDER BY accuracy DESC
```

#### GET /api/performance/history?days=30
ì¼ë³„ ì„±ê³¼ íŠ¸ë Œë“œ (ê¸°ë³¸ 30ì¼)

**Query Parameters**:
- `days` (int, 1-365): ì¡°íšŒí•  ê¸°ê°„ (ê¸°ë³¸ê°’: 30)

**Response**:
```json
[
  {
    "date": "2025-12-23",
    "total": 10,
    "correct": 7,
    "accuracy": 70.0,
    "avg_return": 1.15
  },
  {
    "date": "2025-12-22",
    "total": 8,
    "correct": 5,
    "accuracy": 62.5,
    "avg_return": 0.89
  }
]
```

**ì¿¼ë¦¬**:
```sql
SELECT
    DATE(evaluated_at) as date,
    COUNT(*) as total,
    SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct,
    ROUND(
        CAST(SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) AS NUMERIC) /
        NULLIF(COUNT(*), 0) * 100, 2
    ) as accuracy,
    ROUND(AVG(return_pct), 4) as avg_return
FROM price_tracking
WHERE status = 'COMPLETED'
    AND evaluated_at >= CURRENT_DATE - INTERVAL ':days days'
GROUP BY DATE(evaluated_at)
ORDER BY date DESC
```

#### GET /api/performance/top-sessions?order=best&limit=10
ìµœê³ /ìµœì € ì„±ê³¼ ì„¸ì…˜

**Query Parameters**:
- `order` (string, "best" | "worst"): ì •ë ¬ ìˆœì„œ (ê¸°ë³¸ê°’: "best")
- `limit` (int, 1-50): ë°˜í™˜ ê°œìˆ˜ (ê¸°ë³¸ê°’: 10)

**Response**:
```json
[
  {
    "session_id": 15,
    "ticker": "AAPL",
    "consensus_action": "BUY",
    "consensus_confidence": 0.789,
    "return_pct": 2.35,
    "is_correct": true,
    "performance_score": 0.0185,
    "initial_timestamp": "2025-12-23T09:30:00"
  }
]
```

**ì¿¼ë¦¬**:
```sql
SELECT
    session_id,
    ticker,
    consensus_action,
    consensus_confidence,
    return_pct,
    is_correct,
    performance_score,
    initial_timestamp
FROM price_tracking
WHERE status = 'COMPLETED'
ORDER BY performance_score DESC  -- or ASC for worst
LIMIT :limit
```

---

### 2ï¸âƒ£ Performance Dashboard UI êµ¬í˜„

**íŒŒì¼**:
- [frontend/src/pages/Performance.tsx](../../frontend/src/pages/Performance.tsx)
- [frontend/src/pages/Performance.css](../../frontend/src/pages/Performance.css)

**ì£¼ìš” ê¸°ëŠ¥**:

#### ğŸ“Š 4ê°œ ìš”ì•½ ì¹´ë“œ
1. **Overall Accuracy** ğŸ¯
   - ì „ì²´ ì •í™•ë„ ë°±ë¶„ìœ¨
   - ì •ë‹µ ê°œìˆ˜ / ì „ì²´ ì˜ˆì¸¡ ê°œìˆ˜

2. **Avg Return** ğŸ“ˆ
   - í‰ê·  ìˆ˜ìµë¥  (ì˜ˆì¸¡ë‹¹)
   - ì–‘ìˆ˜/ìŒìˆ˜ ìƒ‰ìƒ êµ¬ë¶„

3. **Avg Performance** â­
   - í‰ê·  ì„±ê³¼ ìŠ¤ì½”ì–´ (ê°€ì¤‘ ì ìˆ˜)
   - return_pct * confidence ê³„ì‚°

4. **Best Action** ğŸ†
   - ê°€ì¥ ì •í™•ë„ ë†’ì€ ì•¡ì…˜ (BUY/SELL/HOLD)
   - ì•¡ì…˜ë³„ ìƒ‰ìƒ êµ¬ë¶„

#### ğŸ“Š Performance by Action
ì•¡ì…˜ë³„ ì„±ê³¼ ê·¸ë¦¬ë“œ ì¹´ë“œ:
- **BUY**: ì´ˆë¡ìƒ‰ ë°°ì§€
- **SELL**: ë¹¨ê°„ìƒ‰ ë°°ì§€
- **HOLD**: ì£¼í™©ìƒ‰ ë°°ì§€

ê° ì¹´ë“œ í‘œì‹œ ì •ë³´:
- Total Predictions
- Correct Predictions
- Avg Return
- Performance Score

#### ğŸ“ˆ Daily Performance Trend
ìµœê·¼ 30ì¼ ì¼ë³„ ì„±ê³¼ í…Œì´ë¸”:
- Date
- Total Predictions
- Correct Predictions
- Accuracy (60% ì´ìƒ ì´ˆë¡ìƒ‰)
- Avg Return (ì–‘ìˆ˜/ìŒìˆ˜ ìƒ‰ìƒ)

#### ğŸ† Top Sessions
ìµœê³ /ìµœì € ì„±ê³¼ ì„¸ì…˜ í† ê¸€ ë·°:
- **Best** ë²„íŠ¼: ì„±ê³¼ ìŠ¤ì½”ì–´ ë†’ì€ ìˆœ
- **Worst** ë²„íŠ¼: ì„±ê³¼ ìŠ¤ì½”ì–´ ë‚®ì€ ìˆœ

í…Œì´ë¸” ì»¬ëŸ¼:
- Session ID
- Ticker
- Action (ë°°ì§€)
- Confidence
- Return
- Correct (âœ…/âŒ)
- Score
- Date

---

### 3ï¸âƒ£ React Router í†µí•©

**íŒŒì¼**:
- [frontend/src/App.tsx](../../frontend/src/App.tsx)
- [frontend/src/components/layout/Navigation.tsx](../../frontend/src/components/layout/Navigation.tsx)

**ë¼ìš°íŒ… ì¶”ê°€**:
```tsx
<Route path="/performance" element={<Performance />} />
```

**Navigation ë©”ë‰´ ì¶”ê°€**:
```tsx
<Link to="/performance" className={`nav-link ${isActive('/performance') ? 'active' : ''}`}>
    <span className="nav-icon">ğŸ“Š</span>
    <span className="nav-label">Performance</span>
</Link>
```

---

## ğŸ¨ UI ë””ìì¸ íŠ¹ì§•

### ìƒ‰ìƒ ì²´ê³„
- **BUY**: `#10b981` (ì´ˆë¡)
- **SELL**: `#ef4444` (ë¹¨ê°•)
- **HOLD**: `#f59e0b` (ì£¼í™©)
- **Positive**: `#10b981` (ì´ˆë¡)
- **Negative**: `#ef4444` (ë¹¨ê°•)

### ë°˜ì‘í˜• ë””ìì¸
- Desktop: 4-column grid for summary cards
- Tablet: 2-column grid
- Mobile: 1-column stack layout

### ì¸í„°ë™ì…˜
- **ì¹´ë“œ í˜¸ë²„ íš¨ê³¼**: ì‚´ì§ ìœ„ë¡œ ì˜¬ë¼ê°€ë©° ê·¸ë¦¼ì ê°•í™”
- **í…Œì´ë¸” í–‰ í˜¸ë²„**: ë°°ê²½ìƒ‰ ë³€ê²½
- **ë²„íŠ¼ ì „í™˜**: Best/Worst í† ê¸€ ë²„íŠ¼

### ìë™ ìƒˆë¡œê³ ì¹¨
- React Query refetchInterval: 60ì´ˆ
- ì‹¤ì‹œê°„ ë°ì´í„° ë°˜ì˜

---

## ğŸ“Š ë°ì´í„° í”Œë¡œìš°

```
1. War Room Debate Completes
   â†“
2. save_initial_price_tracking()
   - price_tracking INSERT (PENDING)
   â†“
3. Wait 24 hours...
   â†“
4. price_tracking_scheduler.py runs
   - UPDATE status = 'COMPLETED'
   - Calculate is_correct, performance_score
   â†“
5. Performance Dashboard Queries
   - GET /api/performance/summary
   - GET /api/performance/by-action
   - GET /api/performance/history
   - GET /api/performance/top-sessions
   â†“
6. Frontend Displays:
   - Overall accuracy cards
   - Action breakdown
   - Daily trend
   - Top/bottom sessions
```

---

## ğŸ”§ ì£¼ìš” íŒŒì¼

### Backend

**API Router**:
- [backend/api/performance_router.py](../../backend/api/performance_router.py) - ì„±ê³¼ API ì—”ë“œí¬ì¸íŠ¸

**Main App**:
- [backend/main.py:339-342](../../backend/main.py#L339-L342) - Router ë“±ë¡

### Frontend

**í˜ì´ì§€**:
- [frontend/src/pages/Performance.tsx](../../frontend/src/pages/Performance.tsx) - Performance ëŒ€ì‹œë³´ë“œ
- [frontend/src/pages/Performance.css](../../frontend/src/pages/Performance.css) - ìŠ¤íƒ€ì¼ì‹œíŠ¸

**ë¼ìš°íŒ…**:
- [frontend/src/App.tsx:31](../../frontend/src/App.tsx#L31) - Performance import
- [frontend/src/App.tsx:60](../../frontend/src/App.tsx#L60) - Route ì¶”ê°€
- [frontend/src/components/layout/Navigation.tsx:56-62](../../frontend/src/components/layout/Navigation.tsx#L56-L62) - ë„¤ë¹„ê²Œì´ì…˜ ë§í¬

---

## âœ… Phase 25.2 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### API ì—”ë“œí¬ì¸íŠ¸
- [x] GET /api/performance/summary
- [x] GET /api/performance/by-action
- [x] GET /api/performance/history
- [x] GET /api/performance/top-sessions
- [x] ì—ëŸ¬ í•¸ë“¤ë§
- [x] ë¹ˆ ë°ì´í„° ì²˜ë¦¬ (No data yet)
- [x] Router ë“±ë¡ (main.py)

### Frontend UI
- [x] Performance.tsx ì»´í¬ë„ŒíŠ¸
- [x] Performance.css ìŠ¤íƒ€ì¼ì‹œíŠ¸
- [x] 4ê°œ ìš”ì•½ ì¹´ë“œ
- [x] ì•¡ì…˜ë³„ ì„±ê³¼ ê·¸ë¦¬ë“œ
- [x] ì¼ë³„ íŠ¸ë Œë“œ í…Œì´ë¸”
- [x] ìµœê³ /ìµœì € ì„¸ì…˜ í…Œì´ë¸”
- [x] Best/Worst í† ê¸€ ë²„íŠ¼
- [x] React Query í†µí•© (auto-refresh)
- [x] ë¡œë”© ìŠ¤í”¼ë„ˆ
- [x] ë¹ˆ ë°ì´í„° í”Œë ˆì´ìŠ¤í™€ë”

### ë¼ìš°íŒ…
- [x] App.tsxì— Route ì¶”ê°€
- [x] Navigation.tsxì— ë§í¬ ì¶”ê°€
- [x] ë°˜ì‘í˜• ë””ìì¸

---

## ğŸš€ ì‹¤í–‰ ê°€ì´ë“œ

### 1. Backend ì‹¤í–‰
```bash
cd ai-trading-system
uvicorn backend.main:app --host 0.0.0.0 --port 8001 --reload
```

### 2. Frontend ì‹¤í–‰
```bash
cd frontend
npm start
# ë˜ëŠ”
npm run dev
```

### 3. Performance Dashboard ì ‘ì†
```
http://localhost:3002/performance
```

---

## ğŸ“Š ì„±ê³¼ ë¶„ì„ ì˜ˆì‹œ

### SQL ì¿¼ë¦¬ ì˜ˆì‹œ

**ì „ì²´ ì •í™•ë„**:
```sql
SELECT
    COUNT(*) as total,
    SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct,
    ROUND(SUM(CASE WHEN is_correct THEN 1 ELSE 0 END)::NUMERIC / COUNT(*) * 100, 2) as accuracy
FROM price_tracking
WHERE status = 'COMPLETED';
```

**ì•¡ì…˜ë³„ í‰ê·  ìˆ˜ìµë¥ **:
```sql
SELECT
    consensus_action,
    AVG(return_pct) as avg_return,
    AVG(performance_score) as avg_score
FROM price_tracking
WHERE status = 'COMPLETED'
GROUP BY consensus_action
ORDER BY avg_score DESC;
```

**ì¼ë³„ ì •í™•ë„ ì¶”ì„¸**:
```sql
SELECT
    DATE(evaluated_at) as date,
    COUNT(*) as total,
    SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct,
    ROUND(SUM(CASE WHEN is_correct THEN 1 ELSE 0 END)::NUMERIC / COUNT(*) * 100, 2) as accuracy
FROM price_tracking
WHERE status = 'COMPLETED'
    AND evaluated_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY DATE(evaluated_at)
ORDER BY date DESC;
```

**ìµœê³  ì„±ê³¼ 10ê°œ**:
```sql
SELECT
    session_id,
    ticker,
    consensus_action,
    return_pct,
    performance_score
FROM price_tracking
WHERE status = 'COMPLETED'
ORDER BY performance_score DESC
LIMIT 10;
```

---

## ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„ (Phase 25.3 - ìê¸°í•™ìŠµ í”¼ë“œë°± ë£¨í”„)

### 1. ì—ì´ì „íŠ¸ë³„ ì„±ê³¼ ì¶”ì 
í˜„ì¬ëŠ” **Consensusë§Œ ì¶”ì ** (PM ìµœì¢… ê²°ì •)
í•„ìš”: **ê°œë³„ ì—ì´ì „íŠ¸ íˆ¬í‘œë³„ ì„±ê³¼ ì¶”ì **

**ìƒˆ í…Œì´ë¸” í•„ìš”**:
```sql
CREATE TABLE agent_vote_tracking (
    id SERIAL PRIMARY KEY,
    session_id INTEGER REFERENCES ai_debate_sessions(id),
    agent_name VARCHAR(50) NOT NULL,  -- trader, analyst, risk, etc.
    vote_action VARCHAR(10) NOT NULL,  -- BUY/SELL/HOLD
    vote_confidence NUMERIC(5, 4) NOT NULL,

    -- 24h later evaluation
    is_correct BOOLEAN,
    performance_score NUMERIC(5, 4),

    created_at TIMESTAMP DEFAULT NOW(),
    evaluated_at TIMESTAMP
);
```

**ì—ì´ì „íŠ¸ë³„ API**:
```python
# GET /api/performance/by-agent
[
    {"agent": "trader", "accuracy": 72.5%, "avg_score": 0.0045},
    {"agent": "analyst", "accuracy": 68.3%, "avg_score": 0.0038},
    {"agent": "risk", "accuracy": 65.0%, "avg_score": 0.0032},
    ...
]
```

### 2. ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
ì„±ê³¼ê°€ ë‚®ì€ ì—ì´ì „íŠ¸ ê°€ì¤‘ì¹˜ í•˜í–¥ ì¡°ì •:
```python
# í˜„ì¬: ëª¨ë“  ì—ì´ì „íŠ¸ ë™ì¼ ê°€ì¤‘ì¹˜ (1.0)
# ë¯¸ë˜: ì„±ê³¼ ê¸°ë°˜ ê°€ì¤‘ì¹˜ ì¡°ì •
weights = {
    "trader": 1.2,   # 72% accuracy â†’ ê°€ì¤‘ì¹˜ ìƒí–¥
    "analyst": 1.0,  # 68% accuracy â†’ ìœ ì§€
    "risk": 0.8,     # 65% accuracy â†’ ê°€ì¤‘ì¹˜ í•˜í–¥
}
```

### 3. ê²½ê³  ì‹œìŠ¤í…œ
ì €ì„±ê³¼ ì—ì´ì „íŠ¸ ê²½ê³ :
```python
if agent_accuracy < 50%:
    logger.warning(f"âš ï¸ Low performing agent: {agent_name} ({agent_accuracy}%)")
    # ì•Œë¦¼ ì „ì†¡ ë˜ëŠ” ìë™ ë¹„í™œì„±í™”
```

### 4. ì‹ ë¢°ë„ vs ì‹¤ì œ ì„±ê³¼ ë¹„êµ
ì—ì´ì „íŠ¸ê°€ ìì‹ ê° ë†’ê²Œ ì˜ˆì¸¡í–ˆì§€ë§Œ í‹€ë¦° ê²½ìš° ë¶„ì„:
```sql
SELECT
    agent_name,
    AVG(vote_confidence) as avg_confidence,
    AVG(CASE WHEN is_correct THEN 1 ELSE 0 END) as accuracy
FROM agent_vote_tracking
WHERE vote_confidence > 0.8  -- 80% ì´ìƒ ìì‹ ê°
GROUP BY agent_name
HAVING AVG(CASE WHEN is_correct THEN 1 ELSE 0 END) < 0.5;  -- í•˜ì§€ë§Œ 50% ë¯¸ë§Œ ì •í™•ë„
```

### 5. í•™ìŠµ ë°ì´í„° ì¶•ì 
ì„±ê³¼ ë°ì´í„°ë¥¼ ì—ì´ì „íŠ¸ í”„ë¡¬í”„íŠ¸ì— í”¼ë“œë°±:
```python
# ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€
system_prompt = f"""
You are a {agent_name} agent.

ğŸ“Š Your Recent Performance:
- Accuracy: {agent_accuracy}%
- Avg Score: {agent_avg_score}
- Best at: {agent_best_scenario}
- Worst at: {agent_worst_scenario}

Based on your performance, please adjust your analysis strategy.
"""
```

---

## ğŸ“ ì•Œë ¤ì§„ ì´ìŠˆ

### Issue #1: ì—ì´ì „íŠ¸ë³„ ì„±ê³¼ ë¯¸ì¶”ì 
**í˜„ì¬**: Consensusë§Œ ì¶”ì  (PM ìµœì¢… ê²°ì •)
**í•„ìš”**: ê°œë³„ ì—ì´ì „íŠ¸ íˆ¬í‘œë³„ ì„±ê³¼ ì¶”ì 
**ìš°ì„ ìˆœìœ„**: High

### Issue #2: ìˆ˜ë™ ê°€ì¤‘ì¹˜ ì¡°ì •
**í˜„ì¬**: ëª¨ë“  ì—ì´ì „íŠ¸ ë™ì¼ ê°€ì¤‘ì¹˜
**í•„ìš”**: ì„±ê³¼ ê¸°ë°˜ ìë™ ê°€ì¤‘ì¹˜ ì¡°ì •
**ìš°ì„ ìˆœìœ„**: Medium

### Issue #3: ë¹ˆ ë°ì´í„° UI
**í˜„ì¬**: "No data yet" ë©”ì‹œì§€ë§Œ í‘œì‹œ
**ê°œì„ **: ìƒ˜í”Œ ë°ì´í„° ë˜ëŠ” ì‹œì‘ ê°€ì´ë“œ ì œê³µ
**ìš°ì„ ìˆœìœ„**: Low

---

## ğŸ”— ê´€ë ¨ Phase

**Phase 25.1**: [24ì‹œê°„ ìˆ˜ìµë¥  ì¶”ì  ì‹œìŠ¤í…œ](./251223_Phase25.1_24ì‹œê°„_ìˆ˜ìµë¥ _ì¶”ì _ì™„ë£Œ.md)
**Phase 27**: [Frontend UI Integration](./251223_Phase27_Frontend_UI_ì™„ë£Œ.md)

---

**ì‘ì„±**: 2025-12-23
**ìƒíƒœ**: âœ… Phase 25.2 ì™„ë£Œ
**ë‹¤ìŒ**: Phase 25.3 - ìê¸°í•™ìŠµ í”¼ë“œë°± ë£¨í”„ (ì—ì´ì „íŠ¸ë³„ ì„±ê³¼ ì¶”ì )
