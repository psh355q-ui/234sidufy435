# Phase 27 - React Router + API Integration ì™„ë£Œ

**ë‚ ì§œ**: 2025-12-23
**Phase**: 27.0 - React Router í†µí•© + API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ“‹ ì™„ë£Œëœ ì‘ì—… ìš”ì•½

### Part 1: Constitutional AI ê°•í™” âœ…
- Constitutional Validatorë¥¼ War Roomì— í†µí•©
- 5ê°œ í—Œë²• ì¡°í•­ ê²€ì¦ (ìë³¸ ë³´ì¡´, ì„¤ëª… ê°€ëŠ¥ì„±, ì¸ê°„ ê²°ì •ê¶Œ, ê°•ì œ ê°œì…, í—Œë²• ê°œì •)
- `execute_trade` íŒŒë¼ë¯¸í„°ë¡œ ì¸ê°„ ìŠ¹ì¸ ì œì–´
- ê²€ì¦ ê²°ê³¼ DB ì €ì¥ (`constitutional_valid`)

### Part 2: í”„ë¡ íŠ¸ì—”ë“œ UI ì¶”ê°€ âœ…
- **Orders í˜ì´ì§€**: ì£¼ë¬¸ íˆìŠ¤í† ë¦¬ ê´€ë¦¬ (í•„í„° + ê²€ìƒ‰)
- **Portfolio í˜ì´ì§€**: í¬íŠ¸í´ë¦¬ì˜¤ ëŒ€ì‹œë³´ë“œ (ìš”ì•½ ì¹´ë“œ + ë³´ìœ  ì¢…ëª©)

### Part 3: React Router í†µí•© âœ…
- **Navigation ì»´í¬ë„ŒíŠ¸**: ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”
- **í˜ì´ì§€ ë¼ìš°íŒ…**: `/war-room`, `/portfolio`, `/orders`
- **App.tsx ì—…ë°ì´íŠ¸**: ë¼ìš°íŠ¸ ì„¤ì • ì™„ë£Œ

### Part 4: API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ âœ…
- **Orders API**: `/api/orders` (ì£¼ë¬¸ íˆìŠ¤í† ë¦¬ ì¡°íšŒ)
- **Portfolio API**: `/api/portfolio` (í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©)
- **FastAPI main.py**: ë¼ìš°í„° ë“±ë¡ ì™„ë£Œ

---

## ğŸ¯ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Frontend (React + Router)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Navigation Bar (ìƒë‹¨ ê³ ì •)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– AI Trading â”‚ ğŸ›ï¸ War Room â”‚ ğŸ’¼ Portfolio â”‚ ğŸ“‹ Ordersâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ War Room    â”‚ Portfolio   â”‚ Orders              â”‚    â”‚
â”‚  â”‚  Page       â”‚  Dashboard  â”‚  Page               â”‚    â”‚
â”‚  â”‚             â”‚             â”‚                     â”‚    â”‚
â”‚  â”‚ â€¢ í† ë¡  ì‹œì‘  â”‚ â€¢ ìš”ì•½ ì¹´ë“œ  â”‚ â€¢ ì£¼ë¬¸ ëª©ë¡          â”‚    â”‚
â”‚  â”‚ â€¢ ì„¸ì…˜ ëª©ë¡  â”‚ â€¢ ë³´ìœ  ì¢…ëª©  â”‚ â€¢ ìƒíƒœ í•„í„°          â”‚    â”‚
â”‚  â”‚ â€¢ ì—ì´ì „íŠ¸   â”‚ â€¢ ìì‚° ë°°ë¶„  â”‚ â€¢ í‹°ì»¤ ê²€ìƒ‰          â”‚    â”‚
â”‚  â”‚   íˆ¬í‘œ í‘œì‹œ  â”‚ â€¢ ì†ìµ ê³„ì‚°  â”‚ â€¢ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (FastAPI)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  API Routers:                                            â”‚
â”‚  â€¢ /api/war-room/debate - War Room í† ë¡  ì‹¤í–‰             â”‚
â”‚  â€¢ /api/war-room/sessions - ì„¸ì…˜ íˆìŠ¤í† ë¦¬                â”‚
â”‚  â€¢ /api/orders - ì£¼ë¬¸ íˆìŠ¤í† ë¦¬ ì¡°íšŒ                       â”‚
â”‚  â€¢ /api/portfolio - í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©                       â”‚
â”‚                                                           â”‚
â”‚  Services:                                               â”‚
â”‚  â€¢ Constitutional Validator - í—Œë²• ì¡°í•­ ê²€ì¦             â”‚
â”‚  â€¢ KIS Broker - ì‹¤ì œ ì£¼ë¬¸ ì‹¤í–‰                           â”‚
â”‚  â€¢ War Room Engine - 7 agents debate                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (PostgreSQL)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ai_debate_sessions - í† ë¡  ì„¸ì…˜ & Constitutional ê²°ê³¼    â”‚
â”‚ â€¢ trading_signals - ì‹œê·¸ë„ ìƒì„±                          â”‚
â”‚ â€¢ orders - ì£¼ë¬¸ ì‹¤í–‰ ë‚´ì—­                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ì£¼ìš” íŒŒì¼

### Backend

**Constitutional AI**:
- [war_room_router.py](backend/api/war_room_router.py) - Constitutional ê²€ì¦ í†µí•©
- [constitution.py](backend/constitution/constitution.py) - í—Œë²• ì¡°í•­ & ê²€ì¦ ë¡œì§

**API Routers**:
- [orders_router.py](backend/api/orders_router.py) - ì£¼ë¬¸ íˆìŠ¤í† ë¦¬ API
- [portfolio_router.py](backend/api/portfolio_router.py) - í¬íŠ¸í´ë¦¬ì˜¤ API
- [main.py](backend/main.py) - ë¼ìš°í„° ë“±ë¡

### Frontend

**Pages**:
- [Orders.tsx](frontend/src/pages/Orders.tsx) - ì£¼ë¬¸ íˆìŠ¤í† ë¦¬ í˜ì´ì§€
- [Orders.css](frontend/src/pages/Orders.css)
- [Portfolio.tsx](frontend/src/pages/Portfolio.tsx) - í¬íŠ¸í´ë¦¬ì˜¤ ëŒ€ì‹œë³´ë“œ
- [Portfolio.css](frontend/src/pages/Portfolio.css)

**Layout**:
- [Navigation.tsx](frontend/src/components/layout/Navigation.tsx) - ë„¤ë¹„ê²Œì´ì…˜ ë°”
- [Navigation.css](frontend/src/components/layout/Navigation.css)

**Router**:
- [App.tsx](frontend/src/App.tsx) - React Router ì„¤ì •

---

## ğŸ”§ API ì—”ë“œí¬ì¸íŠ¸

### 1. Orders API

#### GET `/api/orders`
**ì£¼ë¬¸ íˆìŠ¤í† ë¦¬ ì¡°íšŒ**

**Query Parameters**:
- `status`: ìƒíƒœ í•„í„° (PENDING, FILLED, CANCELLED)
- `ticker`: í‹°ì»¤ í•„í„°
- `limit`: ì¡°íšŒ ê°œìˆ˜ (ê¸°ë³¸ 50, ìµœëŒ€ 500)

**Response**:
```json
[
  {
    "id": 1,
    "ticker": "AAPL",
    "action": "BUY",
    "quantity": 10,
    "price": 178.50,
    "order_type": "MARKET",
    "status": "FILLED",
    "broker": "KIS",
    "order_id": "KIS20251223001",
    "signal_id": 14,
    "created_at": "2025-12-23T12:37:38Z",
    "filled_at": "2025-12-23T12:37:45Z"
  }
]
```

#### GET `/api/orders/{order_id}`
**íŠ¹ì • ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ**

**Response**: ë‹¨ì¼ ì£¼ë¬¸ ê°ì²´

---

### 2. Portfolio API

#### GET `/api/portfolio`
**í¬íŠ¸í´ë¦¬ì˜¤ ì „ì²´ í˜„í™©**

**Response**:
```json
{
  "total_value": 127580.50,
  "cash": 45200.00,
  "invested": 82380.50,
  "total_pnl": 7380.50,
  "total_pnl_pct": 9.84,
  "daily_pnl": 1250.30,
  "daily_return_pct": 0.98,
  "positions": [
    {
      "symbol": "AAPL",
      "quantity": 100,
      "avg_price": 175.20,
      "current_price": 178.50,
      "market_value": 17850.00,
      "profit_loss": 330.00,
      "profit_loss_pct": 1.88,
      "daily_pnl": 150.00,
      "daily_return_pct": 0.84
    }
  ]
}
```

#### GET `/api/portfolio/positions`
**ë³´ìœ  ì¢…ëª©ë§Œ ì¡°íšŒ**

**Response**: positions ë°°ì—´

---

## ğŸ¨ UI ì»´í¬ë„ŒíŠ¸

### Navigation Bar

**íŠ¹ì§•**:
- ìƒë‹¨ ê³ ì • (sticky)
- ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ (ë³´ë¼ìƒ‰)
- í™œì„± í˜ì´ì§€ í•˜ì´ë¼ì´íŠ¸
- Live ìƒíƒœ í‘œì‹œ
- ë°˜ì‘í˜• ë””ìì¸

**ê²½ë¡œ**:
- ğŸ›ï¸ War Room â†’ `/war-room`
- ğŸ’¼ Portfolio â†’ `/portfolio`
- ğŸ“‹ Orders â†’ `/orders`

### Orders Page

**ê¸°ëŠ¥**:
- ì£¼ë¬¸ ëª©ë¡ í…Œì´ë¸” (ì •ë ¬ ê°€ëŠ¥)
- ìƒíƒœë³„ í•„í„° (ì „ì²´/ëŒ€ê¸°ì¤‘/ì²´ê²°/ì·¨ì†Œ)
- í‹°ì»¤ ê²€ìƒ‰
- í†µê³„ ëŒ€ì‹œë³´ë“œ (4ê°œ ì¹´ë“œ)
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (10ì´ˆ)

### Portfolio Page

**ê¸°ëŠ¥**:
- ìš”ì•½ ì¹´ë“œ 4ê°œ (ì´ ìì‚°, íˆ¬ì ê¸ˆì•¡, í˜„ê¸ˆ, ì´ ì†ìµ)
- ë³´ìœ  ì¢…ëª© í…Œì´ë¸” (ì†ìµ ìƒ‰ìƒ êµ¬ë¶„)
- ìì‚° ë°°ë¶„ ì°¨íŠ¸ (ë°” ê·¸ë˜í”„)
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (30ì´ˆ)

---

## âœ… Phase 27 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Constitutional AI
- [x] Constitutional Validator í†µí•©
- [x] War Room ê²€ì¦ ë¡œì§ ì¶”ê°€
- [x] `is_approved` íŒŒë¼ë¯¸í„° ì¸ê°„ ìŠ¹ì¸ ì œì–´
- [x] ê²€ì¦ ê²°ê³¼ DB ì €ì¥
- [x] ë¡œê·¸ ì¶œë ¥ (ìœ„ë°˜ ì‚¬í•­)

### í”„ë¡ íŠ¸ì—”ë“œ UI
- [x] Orders í˜ì´ì§€ êµ¬í˜„
- [x] Portfolio í˜ì´ì§€ êµ¬í˜„
- [x] Navigation ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
- [x] React Router ì„¤ì •
- [x] í˜ì´ì§€ ë¼ìš°íŒ… (/war-room, /portfolio, /orders)
- [x] ë°˜ì‘í˜• ë””ìì¸

### API ì—”ë“œí¬ì¸íŠ¸
- [x] `/api/orders` êµ¬í˜„
- [x] `/api/orders/{id}` êµ¬í˜„
- [x] `/api/portfolio` êµ¬í˜„
- [x] `/api/portfolio/positions` êµ¬í˜„
- [x] FastAPI main.py ë¼ìš°í„° ë“±ë¡

### í”„ë¡ íŠ¸ì—”ë“œ API ì—°ë™
- [x] Orders.tsx API í˜¸ì¶œ
- [x] Portfolio.tsx API í˜¸ì¶œ
- [x] Query Parameters (í•„í„°/ê²€ìƒ‰)
- [x] ì—ëŸ¬ í•¸ë“¤ë§
- [x] ë¡œë”© ìƒíƒœ
- [x] Fallback ë°ì´í„° (Mock)

---

## ğŸš€ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### 1. ë°±ì—”ë“œ ì‹œì‘
```bash
cd ai-trading-system/backend
uvicorn main:app --reload --port 8001
```

### 2. í”„ë¡ íŠ¸ì—”ë“œ ì‹œì‘
```bash
cd ai-trading-system/frontend
npm run dev
```

### 3. í˜ì´ì§€ ì ‘ì†
- War Room: http://localhost:3002/war-room
- Portfolio: http://localhost:3002/portfolio
- Orders: http://localhost:3002/orders

### 4. API í…ŒìŠ¤íŠ¸
```bash
# Orders API
curl http://localhost:8001/api/orders

# Portfolio API
curl http://localhost:8001/api/portfolio

# War Room Sessions
curl http://localhost:8001/api/war-room/sessions
```

---

## ğŸ“Š ì‹œìŠ¤í…œ í”Œë¡œìš° (ì „ì²´)

```
1. User â†’ Navigation Bar
   - Clicks "War Room" / "Portfolio" / "Orders"

2. React Router
   - Routes to corresponding page

3. Page Component
   - useQuery fetches data from API
   - Display loading state
   - Render data or error

4. Backend API
   - /api/orders â†’ Query DB (orders table)
   - /api/portfolio â†’ KIS Broker â†’ Get account balance
   - /api/war-room/sessions â†’ Query DB (ai_debate_sessions)

5. Database / KIS API
   - Return data to backend

6. Backend â†’ Frontend
   - JSON response

7. Frontend
   - Update UI with data
   - Auto-refresh (React Query refetchInterval)
```

---

## ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„ (Phase 25.1)

### 24ì‹œê°„ ìˆ˜ìµë¥  ì¶”ì  ì‹œìŠ¤í…œ

**ëª©í‘œ**: ì—ì´ì „íŠ¸ ì˜ì‚¬ê²°ì • ì„±ê³¼ ì¸¡ì •

**ê¸°ëŠ¥**:
1. **ê°€ê²© ì¶”ì  í…Œì´ë¸”**
   - í† ë¡  ì‹œì  ê°€ê²© ì €ì¥
   - 24ì‹œê°„ í›„ ê°€ê²© ìë™ ì¡°íšŒ
   - ìˆ˜ìµë¥  ê³„ì‚°

2. **ì—ì´ì „íŠ¸ ì„±ê³¼ í‰ê°€**
   - ì—ì´ì „íŠ¸ë³„ ì¶”ì²œ ì •í™•ë„
   - BUY/SELL/HOLD ê° ì•¡ì…˜ë³„ ì„±ê³µë¥ 
   - ì‹ ë¢°ë„ vs ì‹¤ì œ ì„±ê³¼ ë¹„êµ

3. **ìê¸°í•™ìŠµ í”¼ë“œë°±**
   - ì„±ê³¼ ë°ì´í„°ë¥¼ ì—ì´ì „íŠ¸ í•™ìŠµì— í™œìš©
   - ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
   - ì €ì„±ê³¼ ì—ì´ì „íŠ¸ ê²½ê³ 

4. **ì„±ê³¼ ëŒ€ì‹œë³´ë“œ**
   - ì—ì´ì „íŠ¸ë³„ ì„±ê³¼ ì°¨íŠ¸
   - ì‹œê°„ëŒ€ë³„ ì •í™•ë„
   - ìµœê³ /ìµœì € ì„±ê³¼ ì—ì´ì „íŠ¸

**êµ¬í˜„ ê³„íš**:
1. `price_tracking` í…Œì´ë¸” ìƒì„±
2. ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ì¼€ì¤„ëŸ¬ (24ì‹œê°„ í›„ í‰ê°€)
3. `/api/performance` ì—”ë“œí¬ì¸íŠ¸
4. í”„ë¡ íŠ¸ì—”ë“œ ì„±ê³¼ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€

---

**ì‘ì„±**: 2025-12-23
**ìƒíƒœ**: âœ… Phase 27 ì™„ë£Œ
**ë‹¤ìŒ**: Phase 25.1 - 24ì‹œê°„ ìˆ˜ìµë¥  ì¶”ì  ì‹œìŠ¤í…œ
